<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USDJPY Trade Journal</title>

<style>
:root{
  --bg:#0f1220;
  --card:#1b1f3b;
  --accent:#4f7cff;
  --text:#e6e8ff;
  --muted:#9aa0d1;
  --win:#4caf50;
  --lose:#f44336;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:600;
}

nav{
  display:flex;
  gap:8px;
  padding:8px;
}

nav button{
  flex:1;
  background:var(--card);
  color:var(--text);
  border:none;
  padding:10px;
  border-radius:10px;
}
nav button.active{
  background:var(--accent);
}

main{padding:16px}

.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}

.check-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px;
  margin:6px 0;
  border-radius:10px;
  background:rgba(255,255,255,.05);
}

.check-item input{
  width:18px;
  height:18px;
  accent-color:var(--accent);
}

.check-item span{flex:1}

.check-item:has(input:checked){
  background:rgba(79,124,255,.25);
}

.result-box{
  margin:12px 0;
  padding:10px;
  border-radius:10px;
  background:rgba(255,255,255,.05);
}

.allow{color:var(--win)}
.deny{color:var(--lose)}

button.primary{
  width:100%;
  padding:12px;
  background:var(--accent);
  border:none;
  border-radius:10px;
  color:#fff;
  margin-top:10px;
}

input,select,textarea{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
  border:none;
}
textarea{height:60px}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:6px;
  text-align:center;
}
th{color:var(--muted)}
</style>
</head>

<body>
<header>USDJPY ãƒˆãƒ¬ãƒ¼ãƒ‰ç®¡ç†</header>

<nav>
  <button id="tab-check" class="active">ğŸ§  ãƒã‚§ãƒƒã‚¯</button>
  <button id="tab-calendar">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  <button id="tab-stats">ğŸ“Š é›†è¨ˆ</button>
</nav>

<main>

<section id="check" class="card">
<div id="captureHeader" style="font-size:13px;color:var(--muted)">
  <div id="capDate"></div>
  <div id="capResult"></div>
</div>

<h3 id="step1-title">ã‚¹ãƒ†ãƒƒãƒ—â‘ ã€1æ™‚é–“è¶³ã€‘</h3>
<label class="check-item"><input type="checkbox" class="h1"><span>åˆå‹•ãŒå‡ºã¦ã„ã‚‹</span></label>
<label class="check-item"><input type="checkbox" class="h1"><span>ä¼¸ã³ãã£ã¦ã„ãªã„</span></label>
<label class="check-item"><input type="checkbox" class="h1"><span>MAä¹–é›¢ãŒå¤§ãã™ããªã„</span></label>

<h3 id="step2-title">ã‚¹ãƒ†ãƒƒãƒ—â‘¡ã€4æ™‚é–“è¶³ã€‘</h3>
<label class="check-item"><input type="checkbox" class="h4"><span>æ–¹å‘ãŒæ˜ç¢º</span></label>
<label class="check-item"><input type="checkbox" class="h4"><span>å¦å®šãƒ’ã‚²ãªã—</span></label>

<h3>åŸ·è¡Œè¶³</h3>
<label class="check-item"><input type="radio" name="exe" value="15"><span>15åˆ†</span></label>
<label class="check-item"><input type="radio" name="exe" value="60"><span>1æ™‚é–“</span></label>

<div id="finalResult" class="result-box">æœªåˆ¤å®š</div>

<h3>ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²</h3>
<input type="date" id="date">
<input type="time" id="time">
<select id="side"><option>Buy</option><option>Sell</option></select>
<select id="result"><option value="win">å‹ã¡</option><option value="lose">è² ã‘</option></select>

<div id="lossReasonBox" style="display:none">
  <label class="check-item"><input type="radio" name="lossReason" value="SL"><span>SLåˆ°é”</span></label>
  <label class="check-item"><input type="radio" name="lossReason" value="Time"><span>æ™‚é–“åˆ‡ã‚Š</span></label>
</div>

<input type="number" id="lot" placeholder="ãƒ­ãƒƒãƒˆ">
<input type="number" id="amount" placeholder="æç›Š">
<textarea id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆ"></textarea>

<button class="primary" onclick="saveTrade()">ä¿å­˜</button>
<button class="primary" onclick="saveCapture()">ğŸ“¸ åˆ¤å®šã‚’ç”»åƒä¿å­˜</button>
</section>

<section id="calendar" class="card" style="display:none">
  <div id="calendarGrid"></div>
  <div id="dayDetail"></div>
</section>

<section id="stats" class="card" style="display:none">
  <h3>æœˆåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
  <div id="statsContent"></div>
</section>

</main>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const trades = JSON.parse(localStorage.getItem('trades')||'[]');
const captures = JSON.parse(localStorage.getItem('captures')||'[]');

document.getElementById('result').onchange = e=>{
  document.getElementById('lossReasonBox').style.display =
    e.target.value==='lose'?'block':'none';
};

document.querySelectorAll('input').forEach(i=>i.onchange=judge);

function judge(){
  const h1=[...document.querySelectorAll('.h1')].every(c=>c.checked);
  const h4=[...document.querySelectorAll('.h4')].every(c=>c.checked);
  const exe=document.querySelector('input[name="exe"]:checked');
  const box=document.getElementById('finalResult');

  if(!h1){box.textContent='âŒ 1Hæ¡ä»¶NG';box.className='result-box deny';return;}
  if(!h4){box.textContent='âŒ 4Hæ¡ä»¶NG';box.className='result-box deny';return;}
  if(!exe){box.textContent='âš  åŸ·è¡Œè¶³æœªé¸æŠ';return;}

  box.textContent=`âœ… ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¯ï¼ˆ${exe.value}åˆ†ï¼‰`;
  box.className='result-box allow';
}

function saveTrade(){
  const lossReason =
    document.getElementById('result').value==='lose'
    ? document.querySelector('input[name="lossReason"]:checked')?.value
    : null;

  trades.push({
    date:date.value,
    time:time.value,
    side:side.value,
    result:result.value,
    lot:+lot.value,
    amount:+amount.value,
    lossReason,
    comment:comment.value
  });
  localStorage.setItem('trades',JSON.stringify(trades));
  alert('ä¿å­˜ã—ã¾ã—ãŸ');
}

function saveCapture(){
  const now=new Date();
  capDate.textContent=now.toLocaleString();
  capResult.textContent=finalResult.textContent;

  html2canvas(check,{backgroundColor:'#0f1220',scale:2})
    .then(c=>{
      const img=c.toDataURL();
      captures.push({date:now.toISOString().slice(0,10),image:img});
      localStorage.setItem('captures',JSON.stringify(captures));
      const a=document.createElement('a');
      a.href=img;a.download='judge.png';a.click();
    });
}

function renderStats(){
  const byMonth={};
  trades.forEach(t=>{
    const m=t.date.slice(0,7);
    byMonth[m]??=[];byMonth[m].push(t);
  });

  let html='<table><tr><th>æœˆ</th><th>å‹ç‡</th><th>å‹/æ•—</th><th>RR</th><th>DD</th><th>PF</th><th>SL%</th><th>Time%</th></tr>';
  Object.entries(byMonth).forEach(([m,l])=>{
    const w=l.filter(t=>t.amount>0);
    const lo=l.filter(t=>t.amount<0);
    const sl=lo.filter(t=>t.lossReason==='SL').length;
    const ti=lo.filter(t=>t.lossReason==='Time').length;
    const wr=(w.length/l.length*100).toFixed(1);
    const pf=Math.abs(w.reduce((a,b)=>a+b.amount,0)/lo.reduce((a,b)=>a+b.amount,0)).toFixed(2);
    html+=`<tr><td>${m}</td><td>${wr}%</td><td>${w.length}/${lo.length}</td>
    <td>-</td><td>-</td><td>${pf}</td>
    <td>${lo.length?(sl/lo.length*100).toFixed(1):'-'}%</td>
    <td>${lo.length?(ti/lo.length*100).toFixed(1):'-'}%</td></tr>`;
  });
  html+='</table>';
  statsContent.innerHTML=html;
}

function switchTab(id){
  ['check','calendar','stats'].forEach(s=>document.getElementById(s).style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  if(id==='stats') renderStats();
}

tab-check.onclick=()=>switchTab('check');
tab-calendar.onclick=()=>switchTab('calendar');
tab-stats.onclick=()=>switchTab('stats');
</script>

</body>
</html>

