<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USDJPY Trade Journal</title>

<style>
:root {
  --bg:#0f1220; --card:#1b1f3b; --accent:#4f7cff;
  --text:#e6e8ff; --muted:#9aa0d1;
  --win:#4caf50; --lose:#f44336;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);color:var(--text)
}
header{padding:16px;text-align:center;font-size:20px;font-weight:600}
nav{
  display:flex;gap:8px;justify-content:center;flex-wrap:wrap;padding:8px
}
nav button{
  background:var(--card);color:var(--text);border:none;
  padding:8px 14px;border-radius:10px;cursor:pointer
}
nav button.active{background:var(--accent)}
main{padding:16px}
.card{
  background:var(--card);border-radius:14px;padding:16px;
  margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.3)
}
.calendar-header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:8px
}
.calendar{
  display:grid;grid-template-columns:repeat(7,1fr);gap:6px
}
.day{
  padding:6px 0;text-align:center;border-radius:10px;
  background:rgba(255,255,255,.05);cursor:pointer;font-size:12px
}
.day .amount{display:block;font-size:10px}
.day.win{background:rgba(76,175,80,.35)}
.day.lose{background:rgba(244,67,54,.35)}
.day:hover{filter:brightness(1.2)}
.trade-list{margin-top:12px}
.trade-item{
  background:rgba(255,255,255,.05);padding:10px;border-radius:10px;
  margin-bottom:8px;display:flex;justify-content:space-between;
  align-items:center;font-size:13px
}
.trade-item.win{border-left:4px solid var(--win)}
.trade-item.lose{border-left:4px solid var(--lose)}
.trade-item button{
  background:none;border:none;color:var(--muted);cursor:pointer
}
.stats{display:flex;gap:16px;flex-wrap:wrap}
.stat{
  flex:1;min-width:120px;text-align:center;
  background:rgba(255,255,255,.05);
  border-radius:12px;padding:12px
}
input,select{
  width:100%;padding:8px;margin-bottom:8px;
  border-radius:8px;border:none
}
button.primary{
  width:100%;padding:10px;background:var(--accent);
  border:none;border-radius:10px;color:#fff;font-size:16px
}
</style>
</head>

<body>
<header>USDJPY ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²</header>

<nav>
  <button id="tab-calendar" class="active">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  <button id="tab-check">ğŸ§  ãƒã‚§ãƒƒã‚¯</button>
  <button id="tab-record">ğŸ“ è¨˜éŒ²</button>
  <button id="tab-stats">ğŸ“Š é›†è¨ˆ</button>
</nav>

<main>
<section id="calendar" class="card"></section>

<section id="check" class="card" style="display:none">
  <h3>ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
  <label><input type="checkbox"> 1H åˆå‹•ãƒ»å½¢OK</label><br>
  <label><input type="checkbox"> 4H ä½™åŠ›ãƒ»æ•´åˆOK</label><br>
  <label><input type="checkbox"> åŸ·è¡Œè¶³OK</label><br>
  <label><input type="checkbox"> æŠµæŠ—å¸¯å•é¡Œãªã—</label><br>
</section>

<section id="record" class="card" style="display:none">
  <h3>ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²</h3>
  <input type="date" id="tradeDate">
  <input type="time" id="tradeTime">
  <select id="result">
    <option value="win">å‹ã¡</option>
    <option value="lose">è² ã‘</option>
  </select>
  <input type="number" id="lot" placeholder="ãƒ­ãƒƒãƒˆæ•°">
  <input type="number" id="amount" placeholder="æç›Šï¼ˆé‡‘é¡ãƒ»å††ï¼‰">
  <button class="primary" onclick="saveTrade()">ä¿å­˜</button>
</section>

<section id="stats" class="card" style="display:none"></section>
</main>

<script>
const tabs=["calendar","check","record","stats"];
const trades=JSON.parse(localStorage.getItem("trades")||"[]");
let currentMonth=new Date(),selectedDate=null;

tabs.forEach(t=>document.getElementById("tab-"+t).onclick=()=>showTab(t));
function showTab(n){
  tabs.forEach(t=>{
    document.getElementById(t).style.display=t===n?"block":"none";
    document.getElementById("tab-"+t).classList.toggle("active",t===n);
  });
  if(n==="calendar")renderCalendar();
  if(n==="stats")renderStats();
}

function renderCalendar(){
  const el=calendar; el.innerHTML="";
  const y=currentMonth.getFullYear(),m=currentMonth.getMonth();
  const monthTrades=trades.filter(t=>t.date.startsWith(`${y}-${String(m+1).padStart(2,"0")}`));
  const monthTotal=monthTrades.reduce((a,b)=>a+b.amount,0);
  el.innerHTML+=`
  <div class="calendar-header">
    <button onclick="changeMonth(-1)">â†</button>
    <div>${y}-${m+1} ï½œ æœˆè¨ˆ ${monthTotal.toLocaleString()}å††</div>
    <button onclick="changeMonth(1)">â†’</button>
  </div>`;
  const cal=document.createElement("div"); cal.className="calendar";
  const last=new Date(y,m+1,0).getDate();
  for(let d=1;d<=last;d++){
    const ds=`${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const dayTrades=trades.filter(t=>t.date===ds);
    const total=dayTrades.reduce((a,b)=>a+b.amount,0);
    const div=document.createElement("div"); div.className="day";
    if(dayTrades.length)div.classList.add(total>=0?"win":"lose");
    div.innerHTML=`<div>${d}</div>${dayTrades.length?`<span class="amount">${total.toLocaleString()}å††</span>`:""}`;
    div.onclick=()=>{selectedDate=ds;renderCalendar();renderDayDetail(el)};
    cal.appendChild(div);
  }
  el.appendChild(cal);
  if(selectedDate)renderDayDetail(el);
}

function renderDayDetail(el){
  const list=document.createElement("div"); list.className="trade-list";
  list.innerHTML=`<h4>${selectedDate} å†…è¨³</h4>`;
  trades.filter(t=>t.date===selectedDate).forEach((t,i)=>{
    const item=document.createElement("div");
    item.className=`trade-item ${t.result}`;
    item.innerHTML=`<div>${t.time}ï½œ${t.amount.toLocaleString()}å††ï½œ${t.pips.toFixed(1)}p</div>
    <button onclick="deleteTrade('${selectedDate}',${i})">ğŸ—‘</button>`;
    list.appendChild(item);
  });
  el.appendChild(list);
}

function deleteTrade(d,i){
  const idx=trades.findIndex((t,ii)=>t.date===d&&ii===i);
  if(idx>-1){trades.splice(idx,1);localStorage.setItem("trades",JSON.stringify(trades));renderCalendar()}
}
function changeMonth(n){currentMonth.setMonth(currentMonth.getMonth()+n);selectedDate=null;renderCalendar()}

function saveTrade(){
  const lotN=+lot.value,amt=+amount.value;
  if(!tradeDate.value||!tradeTime.value||!lotN)return;
  trades.push({
    date:tradeDate.value,time:tradeTime.value,
    lot:lotN,amount:amt,result:result.value,
    pips:amt/(lotN*1000)
  });
  localStorage.setItem("trades",JSON.stringify(trades));
  showTab("calendar");
}

function renderStats(){
  const wins=trades.filter(t=>t.result==="win");
  const winRate=trades.length?Math.round(wins.length/trades.length*100):0;
  const avgPips=trades.length?(trades.reduce((a,b)=>a+b.pips,0)/trades.length).toFixed(1):0;
  const dd=Math.min(0,...trades.reduce((a,b)=>{a.push((a.at(-1)||0)+b.amount);return a},[]));
  stats.innerHTML=`<div class="stats">
    <div class="stat"><h2>${winRate}%</h2><div>å‹ç‡</div></div>
    <div class="stat"><h2>${avgPips}</h2><div>å¹³å‡pips</div></div>
    <div class="stat"><h2>${dd.toLocaleString()}å††</h2><div>æœ€å¤§DD</div></div>
  </div>`;
}
renderCalendar();
</script>
</body>
</html>
