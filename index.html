<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trade Journal</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #1b1f3b;
      --accent: #4f7cff;
      --text: #e6e8ff;
      --muted: #9aa0d1;
      --win: #4caf50;
      --lose: #f44336;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header {
      padding: 16px;
      font-size: 20px;
      font-weight: 600;
      text-align: center;
    }
    nav {
      display: flex;
      gap: 8px;
      padding: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    nav button {
      background: var(--card);
      color: var(--text);
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
    }
    nav button.active { background: var(--accent); }
    main { padding: 16px; }
    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .day {
      padding: 6px 0;
      text-align: center;
      border-radius: 10px;
      background: rgba(255,255,255,.05);
      cursor: pointer;
      font-size: 12px;
      line-height: 1.2;
      transition: background .2s;
    }
    .day .amount { display:block; font-size:10px; }
    .day.win { background: rgba(76,175,80,.35); }
    .day.lose { background: rgba(244,67,54,.35); }
    .day:hover { filter: brightness(1.2); }
    .trade-list {
      margin-top: 12px;
    }
    .trade-item {
      background: rgba(255,255,255,.05);
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }
    .trade-item.win { border-left: 4px solid var(--win); }
    .trade-item.lose { border-left: 4px solid var(--lose); }
    .trade-item button {
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
    }
    .stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .stat {
      flex: 1;
      min-width: 120px;
      text-align: center;
      background: rgba(255,255,255,.05);
      border-radius: 12px;
      padding: 12px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: none;
    }
    button.primary {
      width: 100%;
      padding: 10px;
      background: var(--accent);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
    }
  </style>
</head>
<body>
<header>USDJPY ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²</header>
<nav>
  <button id="tab-calendar" class="active">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  <button id="tab-check">ğŸ§  ãƒã‚§ãƒƒã‚¯</button>
  <button id="tab-record">ğŸ“ è¨˜éŒ²</button>
  <button id="tab-stats">ğŸ“Š é›†è¨ˆ</button>
</nav>
<main>
  <section id="calendar" class="card"></section>
  <section id="check" class="card" style="display:none;">
    <h3>ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼åˆ¤æ–­ï¼‰</h3>
    <h4>â‘  4æ™‚é–“è¶³ï¼ˆç’°å¢ƒèªè­˜ï¼‰</h4>
    <label><input type="checkbox" class="chk-4h" /> æ˜ç¢ºãªãƒˆãƒ¬ãƒ³ãƒ‰ or ãƒ¬ãƒ³ã‚¸åˆ¤æ–­ãŒã§ãã¦ã„ã‚‹</label><br />
    <label><input type="checkbox" class="chk-4h" /> é«˜å€¤æ´ã¿ãƒ»å®‰å€¤æ´ã¿ã§ã¯ãªã„</label><br />
    <label><input type="checkbox" class="chk-4h" /> ç›´è¿‘ã®å¼·ã„å¦å®šãƒ’ã‚²ãŒãªã„</label><br />

    <h4>â‘¡ 1æ™‚é–“è¶³ï¼ˆå½¢çŠ¶ï¼‰</h4>
    <label><input type="checkbox" class="chk-1h" /> åˆå‹• or æŠ¼ã—ç›®ãƒ»æˆ»ã‚Šç›®</label><br />
    <label><input type="checkbox" class="chk-1h" /> ä¼¸ã³åˆ‡ã£ãŸè¶³ã§ã¯ãªã„</label><br />
    <label><input type="checkbox" class="chk-1h" /> MAä¹–é›¢ãŒå¤§ãã™ããªã„</label><br />
    <label><input type="checkbox" class="chk-1h" /> æŠµæŠ—å¸¯ã©çœŸã‚“ä¸­ã§ã¯ãªã„</label><br />

    <h4>â‘¢ åŸ·è¡Œè¶³ï¼ˆ15åˆ†ï¼‰</h4>
    <label><input type="checkbox" class="chk-exe" /> æ–¹å‘ãŒ1Hã¨ä¸€è‡´ã—ã¦ã„ã‚‹</label><br />
    <label><input type="checkbox" class="chk-exe" /> å‹¢ã„ãŒå‡ºå§‹ã‚ã¦ã„ã‚‹</label><br />
    <label><input type="checkbox" class="chk-exe" /> ãƒ­ã‚¹ã‚«ãƒƒãƒˆä½ç½®ãŒæ˜ç¢º</label><br />

    <h4>â‘£ åˆ¤å®š</h4>
    <div id="checkResult" style="margin:8px 0; font-weight:600; color:var(--muted);">æœªåˆ¤å®š</div>

    <hr style="margin:16px 0; opacity:.2" />

    <h3>ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²ï¼ˆãƒã‚§ãƒƒã‚¯å¾Œï¼‰</h3>
    <input type="date" id="cTradeDate" />
    <input type="time" id="cTradeTime" />
    <select id="cSide">
      <option value="buy">è²·ã„</option>
      <option value="sell">å£²ã‚Š</option>
    </select>
    <select id="cResult">
      <option value="win">å‹ã¡</option>
      <option value="lose">è² ã‘</option>
    </select>
    <input type="number" id="cLot" placeholder="ãƒ­ãƒƒãƒˆæ•°" />
    <input type="number" id="cAmount" placeholder="æç›Šï¼ˆé‡‘é¡ãƒ»å††ï¼‰" />
    <input type="number" id="cPips" placeholder="pipsï¼ˆè‡ªå‹•ï¼‰" disabled />
    <textarea id="cComment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆ" style="width:100%;height:60px;border-radius:8px;"></textarea>
    <button class="primary" onclick="saveCheckedTrade()">ãƒã‚§ãƒƒã‚¯çµæœã§ä¿å­˜</button>
  </section>
  <section id="record" class="card" style="display:none;">
    <h3>ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²</h3>
    <input type="date" id="tradeDate" />
    <input type="time" id="tradeTime" />
    <select id="result">
      <option value="win">å‹ã¡</option>
      <option value="lose">è² ã‘</option>
    </select>
    <input type="number" id="lot" placeholder="ãƒ­ãƒƒãƒˆæ•°" />
    <input type="number" id="amount" placeholder="æç›Šï¼ˆé‡‘é¡ãƒ»å††ï¼‰" />
    <button class="primary" onclick="saveTrade()">ä¿å­˜</button>
  </section>
  <section id="stats" class="card" style="display:none;"></section>
</main>
<script>
const tabs=['calendar','check','record','stats'];
const trades=JSON.parse(localStorage.getItem('trades')||'[]');
let currentMonth=new Date();
let selectedDate=null;

tabs.forEach(t=>document.getElementById('tab-'+t).onclick=()=>showTab(t));
function showTab(name){
  tabs.forEach(t=>{
    document.getElementById(t).style.display=t===name?'block':'none';
    document.getElementById('tab-'+t).classList.toggle('active',t===name);
  });
  if(name==='calendar') renderCalendar();
  if(name==='stats') renderStats();
}
function renderCalendar(){
  const el=document.getElementById('calendar'); el.innerHTML='';
  const y=currentMonth.getFullYear(), m=currentMonth.getMonth();
  const header=document.createElement('div'); header.className='calendar-header';
  const monthTrades=trades.filter(t=>t.date.startsWith(`${y}-${String(m+1).padStart(2,'0')}`));
  const monthTotal=monthTrades.reduce((a,b)=>a+b.amount,0);
  header.innerHTML=`<button onclick="changeMonth(-1)">â†</button><div>${y}-${m+1} ï½œ æœˆè¨ˆ ${monthTotal.toLocaleString()}å††</div><button onclick="changeMonth(1)">â†’</button>`;
  el.appendChild(header);
  const cal=document.createElement('div'); cal.className='calendar';
  const last=new Date(y,m+1,0).getDate();
  for(let d=1;d<=last;d++){
    const ds=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayTrades=trades.filter(t=>t.date===ds);
    const total=dayTrades.reduce((a,b)=>a+b.amount,0);
    const div=document.createElement('div'); div.className='day';
    if(dayTrades.length) div.classList.add(total>=0?'win':'lose');
    div.innerHTML=`<div>${d}</div>${dayTrades.length?`<span class='amount'>${total.toLocaleString()}å††</span>`:''}`;
    div.onclick=()=>{ selectedDate=ds; renderCalendar(); renderDayDetail(el); };
    cal.appendChild(div);
  }
  el.appendChild(cal);
  if(selectedDate) renderDayDetail(el);
}
function renderDayDetail(el){
  const list=document.createElement('div'); list.className='trade-list';
  const dayTrades=trades.filter(t=>t.date===selectedDate);
  list.innerHTML=`<h4>${selectedDate} å†…è¨³</h4>`;
  dayTrades.forEach((t,i)=>{
    const item=document.createElement('div'); item.className=`trade-item ${t.result}`;
    item.innerHTML=`<div>${t.time} ï½œ ${t.amount.toLocaleString()}å†† ï½œ ${t.pips.toFixed(1)}p</div><button onclick="deleteTrade('${selectedDate}',${i})">ğŸ—‘</button>`;
    list.appendChild(item);
  });
  el.appendChild(list);
}
function deleteTrade(date,index){
  const idx=trades.findIndex((t,i)=>t.date===date && i===index);
  if(idx>-1){ trades.splice(idx,1); localStorage.setItem('trades',JSON.stringify(trades)); renderCalendar(); }
}
function changeMonth(d){ currentMonth.setMonth(currentMonth.getMonth()+d); selectedDate=null; renderCalendar(); }
function saveTrade(){
  const date=tradeDate.value, time=tradeTime.value;
  const lotN=Number(lot.value), amt=Number(amount.value);
  const res=result.value;
  const pips=amt/(lotN*1000);
  trades.push({date,time,lot:lotN,amount:amt,result:res,pips});
  localStorage.setItem('trades',JSON.stringify(trades));
  showTab('calendar');
}

function saveCheckedTrade(){
  const date=cTradeDate.value;
  const time=cTradeTime.value;
  const lotN=Number(cLot.value);
  const amt=Number(cAmount.value);
  const pips=amt/(lotN*1000);
  cPips.value=pips.toFixed(1);
  trades.push({
    date,
    time,
    lot:lotN,
    amount:amt,
    pips,
    side:cSide.value,
    result:cResult.value,
    comment:cComment.value
  });
  localStorage.setItem('trades',JSON.stringify(trades));
  showTab('calendar');
});
  localStorage.setItem('trades',JSON.stringify(trades));
  showTab('calendar');
}
function renderStats(){
  const el=document.getElementById('stats');
  const wins=trades.filter(t=>t.result==='win');
  const loses=trades.filter(t=>t.result==='lose');
  const winRate=trades.length?Math.round(wins.length/trades.length*100):0;
  const avgPips=trades.length?(trades.reduce((a,b)=>a+b.pips,0)/trades.length).toFixed(1):0;
  const maxDD=Math.min(0,...trades.reduce((a,b)=>{ a.push((a[a.length-1]||0)+b.amount); return a;},[]));
  el.innerHTML=`<div class='stats'>
    <div class='stat'><h2>${winRate}%</h2><div>å‹ç‡</div></div>
    <div class='stat'><h2>${avgPips}</h2><div>å¹³å‡pips</div></div>
    <div class='stat'><h2>${maxDD.toLocaleString()}å††</h2><div>æœ€å¤§DD</div></div>
  </div>`;
}
renderCalendar();
</script>
</body>
</html>
